<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Limpieza Inmediata - Cache SW</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container {
            background: rgba(0, 0, 0, 0.8);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        .title {
            font-size: 36px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        .status {
            font-size: 20px;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        .success {
            background: rgba(34, 197, 94, 0.3);
            border: 2px solid #22c55e;
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #22c55e;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .emoji {
            font-size: 48px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">üßπ Limpieza Inmediata</h1>
        <div class="emoji">‚ö°</div>
        <div id="status" class="status">Iniciando limpieza del cache...</div>
        <div id="spinner" class="spinner"></div>
        <div id="results" style="display: none;"></div>
    </div>

    <script>
        // Ejecutar limpieza inmediatamente
        
// ===== LIMPIEZA INMEDIATA DEL CACHE =====
// Este script se ejecuta inmediatamente al abrirlo

(async () => {
  console.log('üßπ LIMPIEZA INMEDIATA INICIADA - ' + new Date().toLocaleTimeString());
  
  try {
    // Verificar Service Worker
    if (!('serviceWorker' in navigator)) {
      console.log('‚ùå Service Workers no soportados');
      alert('Service Workers no soportados en este navegador');
      return;
    }
    
    console.log('‚úÖ Service Worker soportado');
    
    // Obtener caches actuales
    const cacheNames = await caches.keys();
    console.log('üìã Caches encontrados:', cacheNames.length);
    cacheNames.forEach(name => console.log('   -', name));
    
    const results = {
      totalCaches: cacheNames.length,
      deleted: [],
      errors: []
    };
    
    console.log('üóëÔ∏è Iniciando eliminaci√≥n de caches...');
    
    // Eliminar TODOS los caches inmediatamente
    for (const cacheName of cacheNames) {
      try {
        const deleted = await caches.delete(cacheName);
        if (deleted) {
          results.deleted.push(cacheName);
          console.log('‚úÖ Eliminado:', cacheName);
        } else {
          console.log('‚ö†Ô∏è No se pudo eliminar:', cacheName);
        }
      } catch (error) {
        results.errors.push(`${cacheName}: ${error.message}`);
        console.error('‚ùå Error eliminando', cacheName, ':', error.message);
      }
    }
    
    // Actualizar Service Worker
    console.log('üîÑ Actualizando Service Worker...');
    const registration = await navigator.serviceWorker.getRegistration();
    if (registration) {
      await registration.update();
      console.log('‚úÖ Service Worker actualizado');
    }
    
    // Verificar resultado final
    const remainingCaches = await caches.keys();
    results.cachesDeleted = results.deleted.length;
    results.cachesRemaining = remainingCaches.length;
    
    // Mostrar resultados
    console.log('\nüéâ LIMPIEZA COMPLETADA');
    console.log('‚ïê'.repeat(40));
    console.log('üìä Total caches:', results.totalCaches);
    console.log('üóëÔ∏è Eliminados:', results.cachesDeleted);
    console.log('üìä Restantes:', results.cachesRemaining);
    
    if (results.cachesRemaining === 0) {
      console.log('üéâ ¬°CACHE COMPLETAMENTE LIMPIO!');
    }
    
    if (results.errors.length > 0) {
      console.log('‚ùå Errores:', results.errors.length);
      results.errors.forEach(err => console.log('   -', err));
    }
    
    // Confirmaci√≥n visual
    const message = results.cachesRemaining === 0 
      ? `¬°LIMPIEZA EXITOSA!\n\n‚úÖ ${results.cachesDeleted} caches eliminados\nüéâ Cache completamente limpio\n\nEl error "SW: Network failed, trying cache" ha sido resuelto.\n\nRecargando p√°gina...`
      : `Limpieza parcial\n\n‚úÖ ${results.cachesDeleted} caches eliminados\nüìä ${results.cachesRemaining} caches restantes\n\nRecargando p√°gina...`;
    
    alert(message);
    
    // Recargar inmediatamente
    console.log('üîÑ Recargando p√°gina en 1 segundo...');
    setTimeout(() => {
      window.location.reload();
    }, 1000);
    
  } catch (error) {
    console.error('‚ùå Error cr√≠tico:', error);
    alert('Error durante la limpieza: ' + error.message);
  }
})();

// ===== FIN DE LIMPIEZA INMEDIATA =====

    </script>
</body>
</html>